//Employee è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ã€‚Employee è¡¨æœ‰ä¸‰åˆ—ï¼šå‘˜å·¥Idï¼Œå…¬å¸åå’Œè–ªæ°´ã€‚
//
// +-----+------------+--------+
//|Id   | Company    | Salary |
//+-----+------------+--------+
//|1    | A          | 2341   |
//|2    | A          | 341    |
//|3    | A          | 15     |
//|4    | A          | 15314  |
//|5    | A          | 451    |
//|6    | A          | 513    |
//|7    | B          | 15     |
//|8    | B          | 13     |
//|9    | B          | 1154   |
//|10   | B          | 1345   |
//|11   | B          | 1221   |
//|12   | B          | 234    |
//|13   | C          | 2345   |
//|14   | C          | 2645   |
//|15   | C          | 2645   |
//|16   | C          | 2652   |
//|17   | C          | 65     |
//+-----+------------+--------+
//
//
// è¯·ç¼–å†™SQLæŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªå…¬å¸çš„è–ªæ°´ä¸­ä½æ•°ã€‚æŒ‘æˆ˜ç‚¹ï¼šä½ æ˜¯å¦å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•å†…ç½®çš„SQLå‡½æ•°çš„æƒ…å†µä¸‹è§£å†³æ­¤é—®é¢˜ã€‚
//
// +-----+------------+--------+
//|Id   | Company    | Salary |
//+-----+------------+--------+
//|5    | A          | 451    |
//|6    | A          | 513    |
//|12   | B          | 234    |
//|9    | B          | 1154   |
//|14   | C          | 2645   |
//+-----+------------+--------+
//
// ðŸ‘ 44 ðŸ‘Ž 0

-- ä¸­ä½æ•°ï¼ˆMedianï¼‰åˆç§°ä¸­å€¼ï¼Œç»Ÿè®¡å­¦ä¸­çš„ä¸“æœ‰åè¯ï¼Œæ˜¯æŒ‰é¡ºåºæŽ’åˆ—çš„ä¸€ç»„æ•°æ®ä¸­å±…äºŽä¸­é—´ä½ç½®çš„æ•°ï¼Œä»£è¡¨ä¸€ä¸ªæ ·
-- æœ¬ã€ç§ç¾¤æˆ–æ¦‚çŽ‡åˆ†å¸ƒä¸­çš„ä¸€ä¸ªæ•°å€¼ï¼Œå…¶å¯å°†æ•°å€¼é›†åˆåˆ’åˆ†ä¸ºç›¸ç­‰çš„ä¸Šä¸‹ä¸¤éƒ¨åˆ†ã€‚ å¯¹äºŽæœ‰é™çš„æ•°é›†ï¼Œå¯ä»¥é€šè¿‡æŠŠ
-- æ‰€æœ‰è§‚å¯Ÿå€¼é«˜ä½ŽæŽ’åºåŽæ‰¾å‡ºæ­£ä¸­é—´çš„ä¸€ä¸ªä½œä¸ºä¸­ä½æ•°ã€‚ å¦‚æžœè§‚å¯Ÿå€¼æœ‰å¶æ•°ä¸ªï¼Œé€šå¸¸å–æœ€ä¸­é—´çš„ä¸¤ä¸ªæ•°å€¼çš„å¹³å‡æ•°
-- ä½œä¸ºä¸­ä½æ•°ã€‚

-- å¯¹äºŽä¸€ä¸ª *å¥‡æ•°* é•¿åº¦æ•°ç»„ä¸­çš„ *ä¸­ä½æ•°*ï¼Œå¤§äºŽè¿™ä¸ªæ•°çš„æ•°å€¼ä¸ªæ•°ç­‰äºŽå°äºŽè¿™ä¸ªæ•°çš„æ•°å€¼ä¸ªæ•°ã€‚
-- æ ¹æ®ä¸Šè¿°çš„å®šä¹‰ï¼Œæˆ‘ä»¬æ¥æ‰¾ä¸€ä¸‹ `[1, 3, 2]` ä¸­çš„ä¸­ä½æ•°ã€‚é¦–å…ˆ `1` ä¸æ˜¯ä¸­ä½æ•°ï¼Œå› ä¸ºè¿™ä¸ªæ•°ç»„æœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œå´æœ‰ä¸¤ä¸ªå…ƒç´  `(3ï¼Œ2)` å¤§äºŽ `1`ã€‚`3` ä¹Ÿä¸æ˜¯ä¸­ä½æ•°ï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªå…ƒç´ å°äºŽ `3`ã€‚å¯¹äºŽæœ€åŽä¸€ä¸ª `2` æ¥è¯´ï¼Œå¤§äºŽ `2` å’Œ å°äºŽ `2` çš„å…ƒç´ æ•°é‡æ˜¯ç›¸ç­‰çš„ï¼Œå› æ­¤ 2 æ˜¯å½“å‰æ•°ç»„çš„ä¸­ä½æ•°ã€‚
-- å½“æ•°ç»„é•¿åº¦ä¸º *å¶æ•°*ï¼Œä¸”å…ƒç´ å”¯ä¸€æ—¶ï¼Œä¸­ä½æ•°ç­‰äºŽæŽ’åºåŽ *ä¸­é—´ä¸¤ä¸ªæ•°* çš„å¹³å‡å€¼ã€‚å¯¹è¿™ä¸¤ä¸ªæ•°æ¥è¯´ï¼Œå¤§äºŽå½“å‰æ•°çš„æ•°å€¼ä¸ªæ•°è·Ÿå°äºŽå½“å‰æ•°çš„æ•°å€¼ä¸ªæ•°ç»å¯¹å€¼ä¹‹å·®ä¸º 1ï¼Œæ°å¥½ç­‰äºŽè¿™ä¸ªæ•°å‡ºçŽ°çš„é¢‘çŽ‡ã€‚
-- æ€»çš„æ¥è¯´ï¼Œä¸ç®¡æ˜¯æ•°ç»„é•¿åº¦æ˜¯å¥‡æ˜¯å¶ï¼Œä¹Ÿä¸ç®¡å…ƒç´ æ˜¯ä¸æ˜¯å”¯ä¸€ï¼Œä¸­ä½æ•°å‡ºçŽ°çš„é¢‘çŽ‡ä¸€å®šå¤§äºŽç­‰äºŽå¤§äºŽå®ƒçš„æ•°å’Œå°äºŽå®ƒçš„æ•°çš„ç»å¯¹å€¼ä¹‹å·®ã€‚è¿™ä¸ªè§„å¾‹æ˜¯è¿™é“é¢˜çš„å…³é”®ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªæœç´¢æ¡ä»¶æ¥è¿‡æ»¤ã€‚

-- æ–¹æ³•ä¸€ï¼šæ ¸å¿ƒåœ¨äºŽ ä¸­ä½æ•°å‡ºçŽ°çš„é¢‘çŽ‡ >=  absï¼ˆå¤§äºŽå®ƒçš„æ•° - å°äºŽå®ƒçš„æ•°ï¼‰
SELECT
    ANY_VALUE(employee.id), employee.company, employee.salary
FROM
    employee,
    employee alias
WHERE
        employee.company = alias.company
GROUP BY employee.company , employee.salary
HAVING SUM(CASE
               WHEN employee.salary = alias.salary THEN 1
               ELSE 0
    END) >= ABS(SUM(SIGN(employee.salary - alias.salary)))
ORDER BY ANY_VALUE(employee.id)
;

-- æ–¹æ³•äºŒï¼š
SELECT id, company, salary
FROM (SELECT *, RANK() OVER(PARTITION BY company ORDER BY salary, id) AS R1,
             RANK() OVER(PARTITION BY company ORDER BY salary DESC, id DESC) AS R2
      FROM employee) AS A
WHERE R1 BETWEEN R2 - 1 AND R2 + 1;




























